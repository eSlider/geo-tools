#!/bin/bash

curl 'https://www.idealista.com/ajax/listingcontroller/listingmapajax.ajax?locationUri=santa-cruz-de-tenerife%2Fsanta-cruz-suroeste&typology=1&operation=2&freeText=&zoom=13&northEast=28.500234697412022%2C+-16.27248920601744&southWest=28.364676787861338%2C+-16.365300793982556&uid=j3vnwemoanfoynh9kf5zyhowboq4f4467nlbpvxz9ep&adfilter_pricemin=default&adfilter_price=default&adfilter_area=default&adfilter_areamax=default&adfilter_amenity=default&adfilter_countryhouses=&adfilter_rooms_0=&adfilter_rooms_1=&adfilter_rooms_2=&adfilter_rooms_3=&adfilter_rooms_4_more=&adfilter_baths_1=&adfilter_baths_2=&adfilter_baths_3=&adfilter_newconstruction=&adfilter_goodcondition=&adfilter_toberestored=&adfilter_housingpetsallowed=&adfilter_hasairconditioning=&adfilter_wardrobes=&adfilter_lift=&adfilter_flatlocation=&adfilter_parkingspace=&adfilter_garden=&adfilter_swimmingpool=&adfilter_hasterrace=&adfilter_boxroom=&adfilter_top_floor=&adfilter_intermediate_floor=&adfilter_ground_floor=&adfilter_digitalvisit=&adfilter_agencyisabank=&adfilter_published=default&adfilter_onlyflats=&adfilter_penthouse=&adfilter_duplex=&adfilter_homes=&adfilter_independent=&adfilter_semidetached=&adfilter_terraced=&adfilter_chalets=' \
  -H 'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:95.0) Gecko/20100101 Firefox/95.0' \
  -H 'Accept: application/json, text/javascript, */*; q=0.01' \
  -H 'Accept-Language: en-US,en;q=0.5' \
  -H 'Accept-Encoding: gzip, deflate, br' \
  -H 'X-Requested-With: XMLHttpRequest' \
  -H 'Connection: keep-alive' \
  -H 'Referer: https://www.idealista.com/alquiler-viviendas/santa-cruz-de-tenerife/santa-cruz-suroeste/mapa-google' \
  -H $'Cookie: datadome=gKNnMu-YttHS_MHJyv4YZyFgyOvPlxhA7zJADOu0uMxg3xFY4BCJAWQuiO.AJhqGEQxoA1GhO0QmwimRCyWwGHIavheOa5sOpITLoiK7Jz_9Vj.qHu1JOY1s1MxhF~9; cto_lwid=59006081-9d48-48f9-a9b6-2c961f8b7063; utag_main=v_id:0176aa48477700119bc48669b3c70004c005800900ac2$_sn:1$_se:377$_ss:0$_st:1609181397797$ses_id:1609174632312%3Bexp-session$_pn:107%3Bexp-session$_prevCompletePageName:11%3A%3A%3A%3A%3A%3A%3A%3Ahome%3Bexp-1609183197801$_prevAdId:82197457%3Bexp-1609183197801$_prevVtSource:portalSites%3Bexp-1609182495800$_prevVtCampaignCode:%3Bexp-1609182495800$_prevVtDomainReferrer:idealista.com%3Bexp-1609182495800$_prevVtSubdomaninReferrer:www.idealista.com%3Bexp-1609182495800$_prevVtUrlReferrer:https%3A%2F%2Fwww.idealista.com%2Fen%2Fventa-viviendas%2Fsan-cristobal-de-la-laguna%2Fguamasa-los-baldios%2F%3Fordenado-por%3Dfecha-publicacion-desc%3Bexp-1609182495800$_prevVtCampaignLinkName:%3Bexp-1609182495800$_prevAdOriginTypeRecommended:undefined%3Bexp-1609183095209; didomi_token=eyJ1c2VyX2lkIjoiMTc2YWE0ODQtYTAwNy02YWZlLTgwZDYtYTdmNjFiOTUxYTBiIiwiY3JlYXRlZCI6IjIwMjAtMTItMjhUMTY6NTc6NDIuOTA4WiIsInVwZGF0ZWQiOiIyMDIwLTEyLTI4VDE2OjU3OjQyLjkwOFoiLCJ2ZW5kb3JzIjp7ImVuYWJsZWQiOlsiZmFjZWJvb2siLCJ0d2l0dGVyIiwiZ29vZ2xlIiwiYzptaXhwYW5lbCIsImM6aWRlYWxpc3RhLWZlUkVqZTJjIiwiYzppZGVhbGlzdGEtTHp0QmVxRTMiLCJjOmFidGFzdHktTExrRUNDajgiLCJjOmhvdGphciIsImM6eWFuZGV4bWV0cmljcyIsImM6YmVhbWVyLUg3dHI3SGl4IiwiYzpjaGFyYmVhdC1aNFFrOENhaCJdfSwicHVycG9zZXMiOnsiZW5hYmxlZCI6WyJhbmFsaXRpY2FzLWR5RlZHUmU4IiwiZ2VvbG9jYXRpb25fZGF0YSJdfSwidmVyc2lvbiI6MiwiYWMiOiJBa3VBQ0Frcy5BQUFBIn0=; euconsent-v2=CO_JJFFO_JJFFAHABBENBECoAP_AAAAAAAAAF5wAwAWgBbAXmAAAAgNAnABUAFYALgAhgBkADLAGoANkAdgA_ACAAEFAIwAUsAp4BV4C0ALSAawA3gB1QD5AIbAQ6Ai8BIgCbAE7AKRAXIAwIBhIDDwGMAMnAZyAzwBnwDkgHKEoHAACAAFgAUAAyABwAEUAMAAxAB4AEQAJgAVQAuABfADEAGYANoAhABDQCIAIkARwApQBbgDCAGUANUAbIA7wB-AEYAI4AU8Aq8BaAFpALqAYoA3ABxADqAHyAQ6Ai8BIgCbAFigLYAXaAvMBh4DIgGTgM5AZ4Az4BpADWAHAFIJgAC4AKAAqABkADgAIAARAAqgBgAGMANAA1AB5AEMARQAmABPACkAFUALAAXAAvgBiADMAHMAQgAhoBEAESAKUAWIAtwBhADKAGiANUAbIA74B9gH6ARYAjABHACUgFBAKGAVcArYBcwC8gGEANoAbgA9ACHQEXgJEATYAnYBQ4CmgFbALFAWwAuABcgC7QF5gMNAYeAxgBkQDJAGTgMuAZyAzwBn0DSANJgawBrIDY4HJgcoQggAALAAoABkAEQAKgAXAAxACGAEwAKoAXAAvgBiADMAG8APQAjgBYgDCAGUANQAb4A74B9gH4AP8AgYBGACOAEpAKCAUMAp4BV4C0ALSAXMAvwBhADFAG0AOoAegBIICRAEqAJsAU0AsUBaMC2ALaAXAAuQBdoDDwGJAMiAZOAzkBngDPgGiANJAaWA4AByQ6DQAAuACgAKgAZAA4ACAAEQAKgAXQAwADGAGgAagA8AB9AEMARQAmABPgCqAKwAWAAuABfADEAGYAN4AcwA9ACEAENAIgAiQBHQCWAJgATQApQBYgC3gGEAYYAyABlADRAGoANkAb4A7wB7QD7AP0Af8BFgEYAI5ASkBKgCggFPAKuAWKAtAC0gFzALqAXkAvwBhADFAG0ANwAcSA6YDqAHoAQ2Ah0BEQCLwEggJEASoAmwBOwChwFNAKsAWKAtCBbAFsgLgAXIAu0Bd4C8wGDAMJAYaAw8BiQDGAGPAMkAZOAyoBlwDOQGfANEgaQBpIDSwGnANYAbGA4uByQHKhILQACAAFwAUABUADIAHAAPAAgABEACoAGEANAA1AB5AEMARQAmABPgCqAKwAWAAuABvADmAHoAQgAhoBEAESAI6ASwBLgCaAFKALcAYYAyABlwDUANUAbIA7wB7AD4gH2AfoBAICLgIwARoAjgBKQCggFLAKeAVcAuYBfgDCAGKANYAbQA3ABvADiAHoAPkAhsBDoCKgEXgJEATEAmUBNgCdgFDgKRAWKAtABbAC5AF3gLzAYEAwYBhIDDQGHgMiAZIAycBlwDOQGfANIAadA1gDWYHIgcqMgOgAUABUAEMAJgAXABHADLAGoAOyAfYB-AEYAI4AUsAq4BWwDeAJiATYAtEBbAC8wGBAMPAZEAzkBngDPgHJAOUFQIAAKAAqACGAEwALgAjgBlgDUAHYAPwAjABHAClgFXgLQAtIBvAEggJiATYApsBbAC5AF5gMCAYeAyIBnIDPAGfANyAckA5QAAA.f_gAAAAAAAAA; xtvrn=$352991$; xtan352991=2-anonymous; xtant352991=1; ABTasty=uid=60sjjecr5da6sys2&fst=1609174663292&pst=-1&cst=1609174663292&ns=1&pvt=516&pvis=516&th=; atuserid=%7B%22name%22%3A%22atuserid%22%2C%22val%22%3A%22dd745d02-5790-4aac-bd55-5cf53e25cbce%22%2C%22options%22%3A%7B%22end%22%3A%222022-01-29T16%3A57%3A43.461Z%22%2C%22path%22%3A%22%2F%22%7D%7D; _hjid=0c1f9dda-23ac-42b5-aebb-2a9436c7f603; TestIfCookieP=ok; pbw=%24b%3d12840%3b%24o%3d99999%3b%24sw%3d1600%3b%24sh%3d1024; pid=710150963963902273; pdomid=23; lcsrd=2020-12-28T16:59:25.9415475Z; uc="G0WuLjfa1tGxXtVTFtCPaCYmxEz3Xofmftb+yxUUhW/P69elYqY+7xxjbnjfUlwPbySAlkRvZDU5gG/5aFRy15Jds60kZ/6WsxlpRrLkbm2NcYFXxngmr3mfO7Txd6tomWX20aS0CWU="; cc=eyJhbGciOiJIUzI1NiJ9.eyJjdCI6MjkxNTkzNTksImV4cCI6MTYzOTc0MDcyNX0.XhqgW2v2vb0fzXVMEsdObl3K14yJHZyQRgwWk3R7AqA; nl="SlXWVzSv8FjkkBSt2g5V4OMfQ3NnQGw3paB9Orf0A5dkZGQPJJX6IzkYMeOB0sPNQQ0lVbX3CguBsSCBy5DS/8zU9ON+NYVQZTIGx/oos4OQnU16ci1YxyM9j5RnotqRCZPMnnnWw3o="; smc="{}"; userUUID=369fb8e1-b8d1-4ec5-b1bf-b8dc5f5b0736; SESSION=7dde9dca2e01ec7c~c94e3002-147b-433a-aabf-ad9adc7f18ec; contactc94e3002-147b-433a-aabf-ad9adc7f18ec="{\'email\':\'/8XCaDTixGJn4cS3dRO3Dp0kUNjt8igDkEFZoSRqlBE=\',\'phone\':null,\'phonePrefix\':null,\'friendEmails\':null,\'name\':\'N2BuHLaj63xn4cS3dRO3DqiCXGmZPfPi\',\'message\':null,\'message2Friends\':null,\'maxNumberContactsAllow\':10,\'defaultMessage\':true}"; askToSaveAlertPopUp=true; cookieSearch-1="/alquiler-viviendas/santa-cruz-de-tenerife/santa-cruz-suroeste/:1639654326429"' -H 'Sec-Fetch-Dest: empty' -H 'Sec-Fetch-Mode: cors' -H 'Sec-Fetch-Site: same-origin' -H 'Sec-GPC: 1' -H 'TE: trailers' |
  gunzip | jq .jsonResponse.map

getExpose
{
  curl 'https://www.idealista.com/addetail-recommendation/90934918?language=es' -H 'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:95.0) Gecko/20100101 Firefox/95.0' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' -H 'Accept-Encoding: gzip, deflate, br' -H 'Connection: keep-alive' -H $'Cookie: datadome=dUUpT9sl8m67CIC_WaVGml1oTsq5UzrSMwcIZQs2aEozSa-fc~~JVljxoB2M1LM4MiIlcIDhR09mSolHsHa-I6sqx2IfNTaUKAqmlgezHo5z9k-uG_BLa1oyLtOS4JA; cto_lwid=59006081-9d48-48f9-a9b6-2c961f8b7063; utag_main=v_id:0176aa48477700119bc48669b3c70004c005800900ac2$_sn:1$_se:377$_ss:0$_st:1609181397797$ses_id:1609174632312%3Bexp-session$_pn:107%3Bexp-session$_prevCompletePageName:11%3A%3A%3A%3A%3A%3A%3A%3Ahome%3Bexp-1609183197801$_prevAdId:82197457%3Bexp-1609183197801$_prevVtSource:portalSites%3Bexp-1609182495800$_prevVtCampaignCode:%3Bexp-1609182495800$_prevVtDomainReferrer:idealista.com%3Bexp-1609182495800$_prevVtSubdomaninReferrer:www.idealista.com%3Bexp-1609182495800$_prevVtUrlReferrer:https%3A%2F%2Fwww.idealista.com%2Fen%2Fventa-viviendas%2Fsan-cristobal-de-la-laguna%2Fguamasa-los-baldios%2F%3Fordenado-por%3Dfecha-publicacion-desc%3Bexp-1609182495800$_prevVtCampaignLinkName:%3Bexp-1609182495800$_prevAdOriginTypeRecommended:undefined%3Bexp-1609183095209; didomi_token=eyJ1c2VyX2lkIjoiMTc2YWE0ODQtYTAwNy02YWZlLTgwZDYtYTdmNjFiOTUxYTBiIiwiY3JlYXRlZCI6IjIwMjAtMTItMjhUMTY6NTc6NDIuOTA4WiIsInVwZGF0ZWQiOiIyMDIwLTEyLTI4VDE2OjU3OjQyLjkwOFoiLCJ2ZW5kb3JzIjp7ImVuYWJsZWQiOlsiZmFjZWJvb2siLCJ0d2l0dGVyIiwiZ29vZ2xlIiwiYzptaXhwYW5lbCIsImM6aWRlYWxpc3RhLWZlUkVqZTJjIiwiYzppZGVhbGlzdGEtTHp0QmVxRTMiLCJjOmFidGFzdHktTExrRUNDajgiLCJjOmhvdGphciIsImM6eWFuZGV4bWV0cmljcyIsImM6YmVhbWVyLUg3dHI3SGl4IiwiYzpjaGFyYmVhdC1aNFFrOENhaCJdfSwicHVycG9zZXMiOnsiZW5hYmxlZCI6WyJhbmFsaXRpY2FzLWR5RlZHUmU4IiwiZ2VvbG9jYXRpb25fZGF0YSJdfSwidmVyc2lvbiI6MiwiYWMiOiJBa3VBQ0Frcy5BQUFBIn0=; euconsent-v2=CO_JJFFO_JJFFAHABBENBECoAP_AAAAAAAAAF5wAwAWgBbAXmAAAAgNAnABUAFYALgAhgBkADLAGoANkAdgA_ACAAEFAIwAUsAp4BV4C0ALSAawA3gB1QD5AIbAQ6Ai8BIgCbAE7AKRAXIAwIBhIDDwGMAMnAZyAzwBnwDkgHKEoHAACAAFgAUAAyABwAEUAMAAxAB4AEQAJgAVQAuABfADEAGYANoAhABDQCIAIkARwApQBbgDCAGUANUAbIA7wB-AEYAI4AU8Aq8BaAFpALqAYoA3ABxADqAHyAQ6Ai8BIgCbAFigLYAXaAvMBh4DIgGTgM5AZ4Az4BpADWAHAFIJgAC4AKAAqABkADgAIAARAAqgBgAGMANAA1AB5AEMARQAmABPACkAFUALAAXAAvgBiADMAHMAQgAhoBEAESAKUAWIAtwBhADKAGiANUAbIA74B9gH6ARYAjABHACUgFBAKGAVcArYBcwC8gGEANoAbgA9ACHQEXgJEATYAnYBQ4CmgFbALFAWwAuABcgC7QF5gMNAYeAxgBkQDJAGTgMuAZyAzwBn0DSANJgawBrIDY4HJgcoQggAALAAoABkAEQAKgAXAAxACGAEwAKoAXAAvgBiADMAG8APQAjgBYgDCAGUANQAb4A74B9gH4AP8AgYBGACOAEpAKCAUMAp4BV4C0ALSAXMAvwBhADFAG0AOoAegBIICRAEqAJsAU0AsUBaMC2ALaAXAAuQBdoDDwGJAMiAZOAzkBngDPgGiANJAaWA4AByQ6DQAAuACgAKgAZAA4ACAAEQAKgAXQAwADGAGgAagA8AB9AEMARQAmABPgCqAKwAWAAuABfADEAGYAN4AcwA9ACEAENAIgAiQBHQCWAJgATQApQBYgC3gGEAYYAyABlADRAGoANkAb4A7wB7QD7AP0Af8BFgEYAI5ASkBKgCggFPAKuAWKAtAC0gFzALqAXkAvwBhADFAG0ANwAcSA6YDqAHoAQ2Ah0BEQCLwEggJEASoAmwBOwChwFNAKsAWKAtCBbAFsgLgAXIAu0Bd4C8wGDAMJAYaAw8BiQDGAGPAMkAZOAyoBlwDOQGfANEgaQBpIDSwGnANYAbGA4uByQHKhILQACAAFwAUABUADIAHAAPAAgABEACoAGEANAA1AB5AEMARQAmABPgCqAKwAWAAuABvADmAHoAQgAhoBEAESAI6ASwBLgCaAFKALcAYYAyABlwDUANUAbIA7wB7AD4gH2AfoBAICLgIwARoAjgBKQCggFLAKeAVcAuYBfgDCAGKANYAbQA3ABvADiAHoAPkAhsBDoCKgEXgJEATEAmUBNgCdgFDgKRAWKAtABbAC5AF3gLzAYEAwYBhIDDQGHgMiAZIAycBlwDOQGfANIAadA1gDWYHIgcqMgOgAUABUAEMAJgAXABHADLAGoAOyAfYB-AEYAI4AUsAq4BWwDeAJiATYAtEBbAC8wGBAMPAZEAzkBngDPgHJAOUFQIAAKAAqACGAEwALgAjgBlgDUAHYAPwAjABHAClgFXgLQAtIBvAEggJiATYApsBbAC5AF5gMCAYeAyIBnIDPAGfANyAckA5QAAA.f_gAAAAAAAAA; xtvrn=$352991$; xtan352991=2-anonymous; xtant352991=1; ABTasty=uid=60sjjecr5da6sys2&fst=1609174663292&pst=-1&cst=1609174663292&ns=1&pvt=516&pvis=516&th=; atuserid=%7B%22name%22%3A%22atuserid%22%2C%22val%22%3A%22dd745d02-5790-4aac-bd55-5cf53e25cbce%22%2C%22options%22%3A%7B%22end%22%3A%222022-01-29T16%3A57%3A43.461Z%22%2C%22path%22%3A%22%2F%22%7D%7D; _hjid=0c1f9dda-23ac-42b5-aebb-2a9436c7f603; TestIfCookieP=ok; pbw=%24b%3d12840%3b%24o%3d99999%3b%24sw%3d1600%3b%24sh%3d1024; pid=710150963963902273; pdomid=23; lcsrd=2020-12-28T16:59:25.9415475Z; uc="G0WuLjfa1tGxXtVTFtCPaCYmxEz3Xofmftb+yxUUhW/P69elYqY+7xxjbnjfUlwPbySAlkRvZDU5gG/5aFRy15Jds60kZ/6WsxlpRrLkbm2NcYFXxngmr3mfO7Txd6tomWX20aS0CWU="; cc=eyJhbGciOiJIUzI1NiJ9.eyJjdCI6MjkxNTkzNTksImV4cCI6MTYzOTc0MTMwOH0.c37JQRG0P-jbIFZG40L-7c3phn6lACn0rhr4_WAS8yY; nl="SlXWVzSv8FjkkBSt2g5V4OMfQ3NnQGw3paB9Orf0A5dkZGQPJJX6IzkYMeOB0sPNQQ0lVbX3CguBsSCBy5DS/8zU9ON+NYVQZTIGx/oos4OQnU16ci1YxyM9j5RnotqRCZPMnnnWw3o="; smc="{}"; userUUID=369fb8e1-b8d1-4ec5-b1bf-b8dc5f5b0736; SESSION=7dde9dca2e01ec7c~c94e3002-147b-433a-aabf-ad9adc7f18ec; contactc94e3002-147b-433a-aabf-ad9adc7f18ec="{\'email\':\'/8XCaDTixGJn4cS3dRO3Dp0kUNjt8igDkEFZoSRqlBE=\',\'phone\':null,\'phonePrefix\':null,\'friendEmails\':null,\'name\':\'N2BuHLaj63xn4cS3dRO3DqiCXGmZPfPi\',\'message\':null,\'message2Friends\':null,\'maxNumberContactsAllow\':10,\'defaultMessage\':true}"; askToSaveAlertPopUp=true; cookieSearch-1="/alquiler-viviendas/santa-cruz-de-tenerife/santa-cruz-suroeste/:1639654846512"; sendc94e3002-147b-433a-aabf-ad9adc7f18ec="{\'friendsEmail\':null,\'email\':\'/8XCaDTixGJn4cS3dRO3Dp0kUNjt8igDkEFZoSRqlBE=\',\'message\':null}"' -H 'Upgrade-Insecure-Requests: 1' -H 'Sec-Fetch-Dest: document' -H 'Sec-Fetch-Mode: navigate' -H 'Sec-Fetch-Site: none' -H 'Sec-Fetch-User: ?1' -H 'Sec-GPC: 1' -H 'Cache-Control: max-age=0' -H 'TE: trailers' | jq.
}


# ("https://thingproxy.freeboard.io/fetch/https://web.gw.fotocasa.es/suggest?query=Puerto | jq .
# curl -v https://api.allorigins.win/get?url=https://web.gw.fotocasa.es/suggest?query=Puerto
# curl -v https://api.allorigins.win/raw?url=https://web.gw.fotocasa.es/suggest?query=Puerto
